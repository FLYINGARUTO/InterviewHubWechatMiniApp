{"version":3,"file":"user.js","sources":["stores/user.js"],"sourcesContent":["import {\r\n\tdefineStore\r\n} from 'pinia'\r\nimport {\r\n\tref\r\n} from \"vue\"\r\nimport userApi from \"../api/user.js\"\r\nimport storage from \"../utils/storage.js\"\r\nexport const useUserStore = defineStore(\"user\", () => {\r\n\tconst user = ref({})\r\n\tconst token = ref(\"\")\r\n\r\n\tfunction login(username, password) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tuserApi.login({\r\n\t\t\t\tusername,\r\n\t\t\t\tpassword\r\n\t\t\t}).then(async res => {\r\n\t\t\t\ttoken.value = res.data.data\n\t\t\t\tawait getUserInfo(res.data.data)\n\t\t\t\t\n\r\n\t\t\t\tstorage.setStorageToken(res.data.data)\r\n\t\t\t\t\r\n\t\t\t\tresolve(res.data)\r\n\t\t\t}).catch(err => reject(err))\r\n\t\t})\r\n\r\n\r\n\r\n\t}\r\n\r\n\tfunction getUserInfo(token) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tuserApi.getUserInfo(token).then(res => {\r\n\t\t\t\tuser.value = res.data.data\r\n\t\t\t\tresolve(res.data.data)\r\n\t\t\t}).catch(err => reject(err))\r\n\t\t})\r\n\t}\r\n\r\n\tfunction logout() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tuserApi.logout().then(res => {\r\n\t\t\t\t//empty all data\r\n\t\t\t\tuser.value = {}\r\n\t\t\t\ttoken.value = \"\"\r\n\t\t\t\tstorage.removeStorageToken()\r\n\t\t\t\tresolve(res.data)\r\n\t\t\t}).catch(err => {\r\n\t\t\t\treject(err)\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\r\n\treturn {\r\n\t\tuser,\r\n\t\ttoken,\r\n\t\tlogin,\r\n\t\tlogout,\r\n\t\tgetUserInfo\r\n\t}\r\n})"],"names":["defineStore","ref","userApi","storage","token"],"mappings":";;;;AAQY,MAAC,eAAeA,cAAAA,YAAY,QAAQ,MAAM;AACrD,QAAM,OAAOC,cAAG,IAAC,EAAE;AACnB,QAAM,QAAQA,cAAG,IAAC,EAAE;AAEpB,WAAS,MAAM,UAAU,UAAU;AAClC,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCC,eAAAA,QAAQ,MAAM;AAAA,QACb;AAAA,QACA;AAAA,MACJ,CAAI,EAAE,KAAK,OAAM,QAAO;AACpB,cAAM,QAAQ,IAAI,KAAK;AACvB,cAAM,YAAY,IAAI,KAAK,IAAI;AAG/BC,sBAAAA,QAAQ,gBAAgB,IAAI,KAAK,IAAI;AAErC,gBAAQ,IAAI,IAAI;AAAA,MAChB,CAAA,EAAE,MAAM,SAAO,OAAO,GAAG,CAAC;AAAA,IAC9B,CAAG;AAAA,EAID;AAED,WAAS,YAAYC,QAAO;AAC3B,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCF,eAAAA,QAAQ,YAAYE,MAAK,EAAE,KAAK,SAAO;AACtC,aAAK,QAAQ,IAAI,KAAK;AACtB,gBAAQ,IAAI,KAAK,IAAI;AAAA,MACrB,CAAA,EAAE,MAAM,SAAO,OAAO,GAAG,CAAC;AAAA,IAC9B,CAAG;AAAA,EACD;AAED,WAAS,SAAS;AACjB,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCF,eAAAA,QAAQ,OAAM,EAAG,KAAK,SAAO;AAE5B,aAAK,QAAQ,CAAE;AACf,cAAM,QAAQ;AACdC,sBAAAA,QAAQ,mBAAoB;AAC5B,gBAAQ,IAAI,IAAI;AAAA,MACpB,CAAI,EAAE,MAAM,SAAO;AACf,eAAO,GAAG;AAAA,MACd,CAAI;AAAA,IACJ,CAAG;AAAA,EACD;AAGD,SAAO;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACA;AACF,CAAC;;"}