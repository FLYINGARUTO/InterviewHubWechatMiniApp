{"version":3,"file":"reg.js","sources":["pages/reg/reg.vue","pages/reg/reg.vue?type=page"],"sourcesContent":["<template>\r\n\t<uni-notice-bar text=\"Currently unavailable except for developers.\" show-icon=\"true\"></uni-notice-bar>\r\n\t<view style=\"padding: 20px; \">\r\n\r\n\t\t<uni-forms :model=\"regFormData\" ref=\"formRef\" :rules=\"formRules\" :label-width=\"85\">\r\n\t\t\t<uni-forms-item label=\"Avatar\">\r\n\t\t\t\t<button style=\"width: 56px;height: 56px;padding: 0;border-radius: 28px\" open-type=\"chooseAvatar\"\r\n\t\t\t\t\t@chooseavatar=\"chooseavatar\" size=\"mini\">\r\n\t\t\t\t\t<image :src=\"avatar\" style=\"width: 56px;height: 56px\" />\r\n\t\t\t\t</button>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item label=\"Nickname\" name=\"nickname\" required>\r\n\t\t\t\t<uni-easyinput v-model=\"regFormData.nickname\" type=\"text\" placeholder=\"nickname\"\r\n\t\t\t\t\tprefix-icon=\"contact\"></uni-easyinput>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item label=\"Username\" name=\"username\" required>\r\n\t\t\t\t<uni-easyinput v-model=\"regFormData.username\" type=\"text\" placeholder=\"username\"\r\n\t\t\t\t\tprefix-icon=\"contact\"></uni-easyinput>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item label=\"Gender\" name=\"gender\" required>\r\n\t\t\t\t<uni-data-checkbox v-model=\"regFormData.gender\" :localdata=\"sexs\"></uni-data-checkbox>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item label=\"Password\" name=\"password\" required>\r\n\t\t\t\t<uni-easyinput v-model=\"regFormData.password\" type=\"password\" placeholder=\"password\"\r\n\t\t\t\t\tprefix-icon=\"locked\"></uni-easyinput>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item label=\"Confirm Password\" name=\"passwordRe\" required>\r\n\t\t\t\t<uni-easyinput v-model=\"regFormData.passwordRe\" type=\"password\" placeholder=\"confirm password\"\r\n\t\t\t\t\tprefix-icon=\"locked\"></uni-easyinput>\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item label=\"Email\" name=\"email\" required>\r\n\t\t\t\t<uni-easyinput v-model=\"regFormData.email\" type=\"text\" placeholder=\"email\"\r\n\t\t\t\t\tprefix-icon=\"email\"></uni-easyinput>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item label=\"Verify\" name=\"verify\" required>\r\n\t\t\t\t<view style=\"justify-content: space-between;display: flex;\">\r\n\t\t\t\t\t<view style=\"width: 50%;\">\r\n\t\t\t\t\t\t<uni-easyinput v-model=\"regFormData.verify\" type=\"text\" placeholder=\"verification code\"\r\n\t\t\t\t\t\t\tprefix-icon=\"email\"></uni-easyinput>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view style=\"width: 48%;\">\r\n\t\t\t\t\t\t<button size=\"mini\" style=\"width: 98%;\" :disabled=\"countDown>0\" @tap=\"getCode\">\r\n\t\t\t\t\t\t\t{{ countDown>0 ? `${countDown}s` : 'Send' }}\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</uni-forms-item>\r\n\t\t</uni-forms>\r\n\r\n\t</view>\r\n\t<button style=\"border-radius: 5px;width: 100%;\" type=\"primary\" @tap=\"submitForm\" size=\"mini\">Register</button>\r\n</template>\r\n<script setup>\r\n\timport {\r\n\t\tonLoad\r\n\t} from \"@dcloudio/uni-app\"\r\n\timport {\r\n\t\treactive,\r\n\t\tref\r\n\t} from 'vue';\r\n\timport baseApi from \"@/api/base.js\"\r\n\timport userApi from \"@/api/user.js\"\r\n\timport fileApi from \"@/api/file.js\"\r\n\timport user from \"@/api/user.js\";\r\n\tconst formRef = ref()\r\n\tconst regFormData = reactive({\r\n\t\tnickname: \"\",\r\n\t\tusername: \"\",\r\n\t\tpassword: \"\",\r\n\t\tpasswordRe: \"\",\r\n\t\tavatar: \"\",\r\n\t\temail: \"\",\n\t\ttype: \"\",\r\n\t\tgender: \"\",\r\n\t\tverify: \"\"\r\n\t})\r\n\tonLoad(() => {\r\n\t\tbaseApi.getParamListByBaseName(\"sex\").then(res => {\r\n\t\t\tconsole.log(\"baseApi request:\", res);\r\n\t\t\tsexs.value = res.data.data.map(item => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttext: item.paramName,\r\n\t\t\t\t\tvalue: item.paramValue\r\n\t\t\t\t}\r\n\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t})\r\n\tlet countDown = ref(0)\r\n\tconst avatar = ref(\"../../static/icon/my0.png\")\r\n\tconst formRules = {\r\n\t\tnickname: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: \"You cannot leave it empty.\"\r\n\t\t\t}, {\r\n\t\t\t\tminLength: 3,\r\n\t\t\t\tmaxLength: 15,\r\n\t\t\t\terrorMessage: \"The length must range from {minLength} to {maxLength}\"\r\n\t\t\t}]\r\n\t\t},\r\n\t\tusername: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: \"You cannot leave it empty.\"\r\n\t\t\t}, {\r\n\t\t\t\tminLength: 3,\r\n\t\t\t\tmaxLength: 15,\r\n\t\t\t\terrorMessage: \"The length must range from {minLength} to {maxLength}\"\r\n\t\t\t}, {\r\n\t\t\t\t//set aside some space for async response\r\n\t\t\t\tvalidateFunction: function(rule, value, data, callback) {\r\n\t\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t\tuserApi.getCountByUsername(value).then(res => {\r\n\t\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t\t\tif (res.data.data > 0) {\r\n\t\t\t\t\t\t\t\treject(new Error(\"Username has been taken!\"))\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t})\r\n\r\n\r\n\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}]\r\n\t\t},\r\n\t\tpassword: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: \"You cannot leave it empty.\"\r\n\t\t\t}, {\r\n\t\t\t\tminLength: 6,\r\n\t\t\t\tmaxLength: 30,\r\n\t\t\t\terrorMessage: \"The length must range from {minLength} to {maxLength}\"\r\n\t\t\t}]\r\n\t\t},\r\n\t\tpasswordRe: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: \"You cannot leave it empty.\"\r\n\t\t\t}, {\r\n\t\t\t\tminLength: 6,\r\n\t\t\t\tmaxLength: 30,\r\n\t\t\t\terrorMessage: \"The length must range from {minLength} to {maxLength}\"\r\n\t\t\t}, {\r\n\t\t\t\tvalidateFunction: function(rule, value, data, callback) {\r\n\r\n\t\t\t\t\tif (value !== regFormData.password)\r\n\t\t\t\t\t\tcallback(\"inputs not consistent\")\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tcallback()\r\n\t\t\t\t}\r\n\t\t\t}]\r\n\t\t},\r\n\t\tgender: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: \"You cannot leave it empty.\"\r\n\t\t\t}, ]\r\n\t\t},\r\n\t\temail: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: \"You cannot leave it empty.\"\r\n\t\t\t}, {\r\n\t\t\t\tminLength: 8,\r\n\t\t\t\tmaxLength: 30,\r\n\t\t\t\terrorMessage: \"The length must range from {minLength} to {maxLength}\"\r\n\t\t\t}, {\r\n\t\t\t\tvalidateFunction: function(rule, value, data, callback) {\r\n\t\t\t\t\tlet re = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/\r\n\t\t\t\t\tif (!re.test(value))\r\n\t\t\t\t\t\tcallback(\"Illegal format!\")\r\n\t\t\t\t\treturn true\r\n\t\t\t\t}\r\n\t\t\t}]\r\n\t\t},\r\n\t\tverify: {\r\n\t\t\trules: [{\r\n\t\t\t\trequired: true,\r\n\t\t\t\terrorMessage: \"You cannot leave it empty.\"\r\n\t\t\t}, {\r\n\t\t\t\tminLength: 6,\r\n\t\t\t\tmaxLength: 6,\r\n\t\t\t\terrorMessage: \"The length must exactly be {maxLength}\"\r\n\t\t\t}, {\r\n\t\t\t\tvalidateFunction: function(rule, value, data, callback) {\r\n\t\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t\tuserApi.checkCodeValid(regFormData.email, value).then(res => {\r\n\t\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t\t\tif (res.data.message != null && res.data.message != \"Success\")\r\n\t\t\t\t\t\t\t\treject(new Error(res.data.message))\r\n\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}]\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tconst submitForm = () => {\r\n\t\tconsole.log(\"button pressed\")\r\n\t\tconsole.log(\"Validation result:\", formRef.value.validate());\r\n\t\tformRef.value.validate().then(res => {\n\t\t\tconsole.log(\"All inputs comply by the form's rule.\")\r\n\t\t\tregFormData.type='1' //normal registration\r\n\t\t\tuserApi.register(regFormData).then(regRes => {\r\n\t\t\t\tconsole.log(\"registration success\")\r\n\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\turl: \"/pages/reg/reg-success\"\r\n\t\t\t\t})\r\n\t\t\t}).catch(err => {\r\n\t\t\t\tconsole.log(\"fail\")\r\n\t\t\t})\r\n\r\n\r\n\r\n\t\t})\r\n\t}\r\n\tconst getCode = () => {\r\n\t\tuserApi.getVerificationCode(regFormData.email, \"reset\").then(() => {\r\n\t\t\tcountDown.value = 60\r\n\t\t\tlet interval = setInterval(() => {\r\n\t\t\t\tcountDown.value--\r\n\t\t\t\tif (countDown.value === 0) {\r\n\t\t\t\t\tclearInterval(interval)\r\n\t\t\t\t\tconsole.log(\"Cooldown Finished\")\r\n\t\t\t\t}\r\n\t\t\t}, 1000)\r\n\t\t})\r\n\r\n\t}\r\n\tconst chooseavatar = (e) => {\r\n\r\n\t\tfileApi.uploadFile(e.detail.avatarUrl).then(res => {\r\n\t\t\tconsole.log(\"upload response:\", res.data)\r\n\t\t\tavatar.value = e.detail.avatarUrl\r\n\t\t\tregFormData.avatar = res.data.fileName\r\n\t\t}).catch(err => {\r\n\t\t\tconsole.error(err)\r\n\t\t})\r\n\r\n\r\n\r\n\t}\r\n\tconst sexs = ref([{\r\n\t\t\ttext: \"male\",\r\n\t\t\tvalue: 1\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"female\",\r\n\t\t\tvalue: 2\r\n\t\t},\r\n\t\t{\r\n\t\t\ttext: \"prefer not to say\",\r\n\t\t\tvalue: 3\r\n\t\t}\r\n\t])\r\n</script>\r\n<style>\r\n\r\n</style>","import MiniProgramPage from '/Users/flyingbuta/Desktop/WechatMini/frontend/pages/reg/reg.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","onLoad","baseApi","uni","userApi","fileApi","MiniProgramPage"],"mappings":"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"}