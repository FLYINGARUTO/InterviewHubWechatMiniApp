{"version":3,"file":"index.js","sources":["pages/index/index.vue","pages/index/index.vue?type=page"],"sourcesContent":["<script setup>\r\n\timport {useUserStore} from \"../../stores/user.js\"\r\n\timport {onLoad} from \"@dcloudio/uni-app\"\r\n\timport {ref} from \"vue\"\r\n\timport baseApi from \"@/api/base.js\"\n\timport articleApi from \"@/api/article.js\"\n\t//初始化useUserStore() 里面持久化存储user和token\r\n\tconst useUser = useUserStore()\r\n\n\t//跳转回登录页\r\n\tconst back2log = () => {\r\n\r\n\t\tuni.redirectTo({\r\n\t\t\turl: '/pages/login'\r\n\t\t})\r\n\t}\n\t//安全边距（top\r\n\tconst safeTop = ref(0)\n\t//下拉刷新trigger\n\tconst triggered = ref(false)\n\t//上拉刷新status\n\tconst loadMoreStatus = ref(\"more\")\n\tconst loadMore =async ()=>{\n\t\t\n\t\tif(loadMoreStatus.value==\"noMore\"){\n\t\t\treturn false\n\t\t}\n\t\tconsole.log(\"------>上拉加载更多\")\n\t\tloadMoreStatus.value = \"loading\"\n\t\tqueryParam.value.pageNo++;\n\t\tlet res = await articleApi.list(queryParam.value)\n\t\tsetTimeout(()=>{\n\t\t\tarticleList.value = articleList.value.concat(res.data.data.rows)\n\t\t\tif(articleList.value.length < res.data.data.total){\n\t\t\t\tloadMoreStatus.value = \"more\"\n\t\t\t}else{ \n\t\t\t\tloadMoreStatus.value = \"noMore\"\n\t\t\t}\n\t\t},1000)\n\t\t\n\t}\n\tasync function refreshFeed(){\n\t\tconsole.log(\"---->下拉刷新\")\n\t\ttriggered.value=true\n\t\t\n\t\t\n\t\tawait search()\n\t\t\n\t\t\n\t\ttriggered.value=false\n\t}\n\t//categoryTab\n\tconst categoryList=ref([\n\t\t{id:0,paramName:\"全部\",paramValue:\"\"} //categoryId为空\n\t])\n\tconst categoryIndex=ref(0)\n\t//分类tab事件\n\tconst valueChange=(e,categoryId)=>{\n\t\tcategoryIndex.value=e //这个是为了控制样式的\n\t\tqueryParam.value.categoryId=categoryId\n\t\tsearch()\n\t\t\n\t}\n\tconst queryParam = ref({\n\t\tpageNo: 1,\n\t\tpageSize: 5,\n\t\ttitle : \"\"\n\t})\n\tconst articleRes=ref({})\n\tconst articleList=ref([])\n\t\r\n\tonLoad(async () => {\n\t\t//获取系统的信息\n\t\t//获取系统安全显示区域\r\n\t\tlet {safeArea} = uni.getSystemInfoSync()\r\n\t\tsafeTop.value = safeArea.top + 10\n\t\t\n\t\tlet res=await baseApi.getParamListByBaseName(\"articleType\")\n\t\tcategoryList.value=categoryList.value.concat(res.data.data)\n\t\t\n\t\tawait search()\n\t\t\r\n\t})\n\tconst search=async ()=>{\n\t\tqueryParam.value.pageNo=1\n\t\tconsole.log(\"query:\",queryParam.value)\n\t\tlet res=await articleApi.list(queryParam.value)\n\t\tconsole.log(res.data.data)\n\t\t\n\t\tarticleList.value=res.data.data.rows\n\n\t}\n\tconst clearSearch=()=>{\n\t\tqueryParam.value.title=\"\"\n\t\tsearch()\n\t}\n\t\n\n\tconst viewDetail=(id)=>{\n\t\tuni.navigateTo({\n\t\t\turl:'/pages/articles/article?id='+id\n\t\t})\n\t}\r\n</script>\r\n\r\n<template>\r\n\t<view>\r\n\t\t<view class=\"top\" :style=\"{paddingTop: safeTop+'px'}\">\r\n\t\t\t<view class=\"title\">\n\t\t\t\t程序员面试宝典\n\t\t\t</view>\r\n\t\t\t\r\n\t\t\t<uni-search-bar v-model=\"queryParam.title\" placeholder=\"搜索...\" radius=\"100\"\r\n\t\t\t\tclearButton=\"auto\" cancelButton=\"none\" @confirm=\"search\" @clear=\"clearSearch\">\n\t\t\t</uni-search-bar>\r\n\t\t\t<view class=\"categoryTab\">\n\t\t\t\t<view class=\"item\" :class=\"{active: index==categoryIndex}\"\n\t\t\t\tv-for=\"(item,index) in categoryList\" @click=\"valueChange(index,item.paramValue)\" :key=\"item.id\">\n\t\t\t\t\t<text>{{item.paramName}}</text>\n\t\t\t\t\t<text v-if=\"index==categoryIndex\" style=\"line-height: 8px;\">-</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\r\n\t\t</view> \n\t\t<scroll-view scroll-y=\"true\" show-scrollbar=\"true\" :style=\"{height: 'calc(100vh - '+(safeTop + 110)+'px)'}\" \n\t\t\trefresher-enabled=\"true\" :refresher-threshold=\"50\" :refresher-triggered=\"triggered\" @refresherrefresh=\"refreshFeed\"\n\t\t\tenable-back-to-top=\"true\" @scrolltolower=\"loadMore\"> \n\t\t\t<m-card @tap=\"viewDetail(item.id)\" v-for=\"(item,value) in articleList\" :localdata=\"item\" :key=\"item.id\"></m-card>\n\t\t\t<view class=\"no-data\" v-if=\"articleList.length==0\">\n\t\t\t\t<image src=\"/static/icon/fail.png\" mode=\"widthFix\"></image>\n\t\t\t\t没有匹配的结果\n\t\t\t</view>\n\t\t\t<view style=\"height: 200px;\" v-else>\n\t\t\t\t<uni-load-more :status=\"loadMoreStatus\"></uni-load-more>\n\t\t\t</view>\n\t\t</scroll-view>\n\t\t\t\r\n\r\n\t\t<!-- <button @click=\"back2log\">Login</button> -->\r\n\r\n\t</view>\r\n</template>\r\n\r\n\r\n<style lang=\"scss\">\r\n\t.top {\n\t\theight: 100px;\r\n\t\tbackground-color: #d2302c;\n\t\tpadding: 20px 0 10px;\n\t\t.title{\n\t\t\tcolor: white;\n\t\t\tfont-weight: bold;\n\t\t\tpadding-left: 15px;\n\t\t}\n\t\t.categoryTab{\n\t\t\tdisplay: flex;\n\t\t\tpadding-left: 15px;\n\t\t\tcolor: lightgray;\n\t\t\t.item{\n\t\t\t\ttext-align: center;\n\t\t\t\tfont-size: 12px;\n\t\t\t\tmargin-right: 10px;\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t}\n\t\t\t.active{\n\t\t\t\tfont-weight: bold;\n\t\t\t\tcolor: white;\n\t\t\t}\n\t\t}\n\r\n\t}\n\t.no-data{\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tfont-size: 14px;\n\t\tcolor: gray;\n\t\timage{\n\t\t\twidth: 60px;\n\t\t}\n\t\tmargin: 100px 0 50px;\n\t}\n\r\n</style>","import MiniProgramPage from '/Users/flyingbuta/Desktop/WechatMini/frontend/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserStore","ref","uni","articleApi","onLoad","baseApi","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAOiBA,6BAAc;AAU9B,UAAM,UAAUC,cAAG,IAAC,CAAC;AAErB,UAAM,YAAYA,cAAG,IAAC,KAAK;AAE3B,UAAM,iBAAiBA,cAAG,IAAC,MAAM;AACjC,UAAM,WAAU,YAAU;AAEzB,UAAG,eAAe,SAAO,UAAS;AACjC,eAAO;AAAA,MACP;AACDC,oBAAAA,MAAY,MAAA,OAAA,+BAAA,eAAe;AAC3B,qBAAe,QAAQ;AACvB,iBAAW,MAAM;AACjB,UAAI,MAAM,MAAMC,YAAAA,WAAW,KAAK,WAAW,KAAK;AAChD,iBAAW,MAAI;AACd,oBAAY,QAAQ,YAAY,MAAM,OAAO,IAAI,KAAK,KAAK,IAAI;AAC/D,YAAG,YAAY,MAAM,SAAS,IAAI,KAAK,KAAK,OAAM;AACjD,yBAAe,QAAQ;AAAA,QAC3B,OAAQ;AACJ,yBAAe,QAAQ;AAAA,QACvB;AAAA,MACD,GAAC,GAAI;AAAA,IAEN;AACD,mBAAe,cAAa;AAC3BD,oBAAAA,MAAA,MAAA,OAAA,+BAAY,WAAW;AACvB,gBAAU,QAAM;AAGhB,YAAM,OAAQ;AAGd,gBAAU,QAAM;AAAA,IAChB;AAED,UAAM,eAAaD,cAAAA,IAAI;AAAA,MACtB,EAAC,IAAG,GAAE,WAAU,MAAK,YAAW,GAAE;AAAA;AAAA,IACpC,CAAE;AACD,UAAM,gBAAcA,cAAG,IAAC,CAAC;AAEzB,UAAM,cAAY,CAAC,GAAE,eAAa;AACjC,oBAAc,QAAM;AACpB,iBAAW,MAAM,aAAW;AAC5B,aAAQ;AAAA,IAER;AACD,UAAM,aAAaA,cAAAA,IAAI;AAAA,MACtB,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,OAAQ;AAAA,IACV,CAAE;AACgBA,kBAAAA,IAAI,CAAA,CAAE;AACvB,UAAM,cAAYA,cAAG,IAAC,EAAE;AAExBG,kBAAAA,OAAO,YAAY;AAGlB,UAAI,EAAC,SAAQ,IAAIF,cAAG,MAAC,kBAAmB;AACxC,cAAQ,QAAQ,SAAS,MAAM;AAE/B,UAAI,MAAI,MAAMG,iBAAQ,uBAAuB,aAAa;AAC1D,mBAAa,QAAM,aAAa,MAAM,OAAO,IAAI,KAAK,IAAI;AAE1D,YAAM,OAAQ;AAAA,IAEhB,CAAE;AACD,UAAM,SAAO,YAAU;AACtB,iBAAW,MAAM,SAAO;AACxBH,oBAAY,MAAA,MAAA,OAAA,+BAAA,UAAS,WAAW,KAAK;AACrC,UAAI,MAAI,MAAMC,YAAAA,WAAW,KAAK,WAAW,KAAK;AAC9CD,oBAAA,MAAA,MAAA,OAAA,+BAAY,IAAI,KAAK,IAAI;AAEzB,kBAAY,QAAM,IAAI,KAAK,KAAK;AAAA,IAEhC;AACD,UAAM,cAAY,MAAI;AACrB,iBAAW,MAAM,QAAM;AACvB,aAAQ;AAAA,IACR;AAGD,UAAM,aAAW,CAAC,OAAK;AACtBA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAI,gCAA8B;AAAA,MACrC,CAAG;AAAA,IACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrGF,GAAG,WAAWI,SAAe;"}